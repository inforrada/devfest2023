<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="">

    <script>
        let response = {
            "get": "fixtures",
            "parameters": {
                "season": "2023",
                "next": "3",
                "team": "4907"
            },
            "errors": [],
            "results": 3,
            "paging": {
                "current": 1,
                "total": 1
            },
            "response": [{
                    "fixture": {
                        "id": 1083949,
                        "referee": null,
                        "timezone": "UTC",
                        "date": "2023-12-03T19:00:00+00:00",
                        "timestamp": 1701630000,
                        "periods": {
                            "first": null,
                            "second": null
                        },
                        "venue": {
                            "id": 20313,
                            "name": "Instalaciones de Zubieta",
                            "city": "Donostia-San Sebastián"
                        },
                        "status": {
                            "long": "Not Started",
                            "short": "NS",
                            "elapsed": null
                        }
                    },
                    "league": {
                        "id": 435,
                        "name": "Primera División RFEF - Group 1",
                        "country": "Spain",
                        "logo": "https://media-4.api-sports.io/football/leagues/435.png",
                        "flag": "https://media-4.api-sports.io/flags/es.svg",
                        "season": 2023,
                        "round": "Group 1 - 15"
                    },
                    "teams": {
                        "home": {
                            "id": 9585,
                            "name": "Real Sociedad II",
                            "logo": "https://media-4.api-sports.io/football/teams/9585.png",
                            "winner": null
                        },
                        "away": {
                            "id": 4907,
                            "name": "Ponferradina",
                            "logo": "https://media-4.api-sports.io/football/teams/4907.png",
                            "winner": null
                        }
                    },
                    "goals": {
                        "home": null,
                        "away": null
                    },
                    "score": {
                        "halftime": {
                            "home": null,
                            "away": null
                        },
                        "fulltime": {
                            "home": null,
                            "away": null
                        },
                        "extratime": {
                            "home": null,
                            "away": null
                        },
                        "penalty": {
                            "home": null,
                            "away": null
                        }
                    }
                },
                {
                    "fixture": {
                        "id": 1083956,
                        "referee": null,
                        "timezone": "UTC",
                        "date": "2023-12-10T17:00:00+00:00",
                        "timestamp": 1702227600,
                        "periods": {
                            "first": null,
                            "second": null
                        },
                        "venue": {
                            "id": 3708,
                            "name": "Estadio El Toralín",
                            "city": "Ponferrada"
                        },
                        "status": {
                            "long": "Not Started",
                            "short": "NS",
                            "elapsed": null
                        }
                    },
                    "league": {
                        "id": 435,
                        "name": "Primera División RFEF - Group 1",
                        "country": "Spain",
                        "logo": "https://media-4.api-sports.io/football/leagues/435.png",
                        "flag": "https://media-4.api-sports.io/flags/es.svg",
                        "season": 2023,
                        "round": "Group 1 - 16"
                    },
                    "teams": {
                        "home": {
                            "id": 4907,
                            "name": "Ponferradina",
                            "logo": "https://media-4.api-sports.io/football/teams/4907.png",
                            "winner": null
                        },
                        "away": {
                            "id": 5258,
                            "name": "Cornellà",
                            "logo": "https://media-4.api-sports.io/football/teams/5258.png",
                            "winner": null
                        }
                    },
                    "goals": {
                        "home": null,
                        "away": null
                    },
                    "score": {
                        "halftime": {
                            "home": null,
                            "away": null
                        },
                        "fulltime": {
                            "home": null,
                            "away": null
                        },
                        "extratime": {
                            "home": null,
                            "away": null
                        },
                        "penalty": {
                            "home": null,
                            "away": null
                        }
                    }
                },
                {
                    "fixture": {
                        "id": 1083960,
                        "referee": null,
                        "timezone": "UTC",
                        "date": "2023-12-17T16:00:00+00:00",
                        "timestamp": 1702828800,
                        "periods": {
                            "first": null,
                            "second": null
                        },
                        "venue": {
                            "id": 2917,
                            "name": "Estadi Johan Cruyff",
                            "city": "Sant Joan Despí"
                        },
                        "status": {
                            "long": "Not Started",
                            "short": "NS",
                            "elapsed": null
                        }
                    },
                    "league": {
                        "id": 435,
                        "name": "Primera División RFEF - Group 1",
                        "country": "Spain",
                        "logo": "https://media-4.api-sports.io/football/leagues/435.png",
                        "flag": "https://media-4.api-sports.io/flags/es.svg",
                        "season": 2023,
                        "round": "Group 1 - 17"
                    },
                    "teams": {
                        "home": {
                            "id": 712,
                            "name": "Barcelona B",
                            "logo": "https://media-4.api-sports.io/football/teams/712.png",
                            "winner": null
                        },
                        "away": {
                            "id": 4907,
                            "name": "Ponferradina",
                            "logo": "https://media-4.api-sports.io/football/teams/4907.png",
                            "winner": null
                        }
                    },
                    "goals": {
                        "home": null,
                        "away": null
                    }
                }
            ]
        };

        /////////////// ver si usamos

        function formatearFecha(fechaISO) {
            const fecha = new Date(fechaISO);

            // Obtener día, mes y año
            const dia = fecha.getDate();
            const mes = obtenerNombreMes(fecha.getMonth());
            const año = fecha.getFullYear();

            // Obtener hora y minutos
            let hora = fecha.getHours();
            let minutos = fecha.getMinutes();

            // Agregar cero inicial si los minutos son menores a 10
            minutos = minutos < 10 ? '0' + minutos : minutos;

            // Construir la cadena formateada
            const fechaFormateada = `${dia} de ${mes} de ${año} a las ${hora}:${minutos}`;

            return fechaFormateada;
        }

        function obtenerNombreMes(numeroMes) {
            const nombresMeses = [
                'enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio',
                'julio', 'agosto', 'septiembre', 'octubre', 'noviembre', 'diciembre'
            ];

            return nombresMeses[numeroMes];
        }




        ////////////// fin ver si usamos





        function getValueByPath(obj, path) {
            let op = path.split('->');
            let pathArray = '';

            if (op.length > 1) {
                pathArray = op[1].split('.');
                op = op[0];
            } else {
                op = '';
                pathArray = path.split('.');
            }

            // Iterar a través de las partes de la ruta y acceder a los nodos del objeto
            for (let i = 0; i < pathArray.length; i++) {
                // Verificar si la propiedad actual existe en el objeto
                if (obj.hasOwnProperty(pathArray[i])) {
                    // Acceder al siguiente nivel del objeto
                    obj = obj[pathArray[i]];
                } else {
                    // Si la propiedad no existe, devolver un valor predeterminado en este caso, ponemos traza y luego devolveremos cadena vacía
                    return pathArray[i] + ": no se ha encontrado";
                }
            }
            if (op != '') {
                if (typeof window[op] === "function") {
                    return window[op](obj);
                }
            }

            return obj;

        }


        function procesarTexto(response, texto) {
            const patron = /\[\[(.*?)\]\]/g;
            const textoProcesado = texto.replace(patron, (match, p1) => getValueByPath(response, p1));

            return textoProcesado;
        }


        function test() {

            let plantilla = $("#plantilla").val();
            let transformado = procesarTexto(response, plantilla);
            $("#resultado").html(transformado);
        }

        function procesar() {
            let miEquipo = $("#miEquipo").val();
            const settings = {
                async: true,
                crossDomain: true,
                url: 'https://api-football-v1.p.rapidapi.com/v3/fixtures?season=2023&team=' + miEquipo + '&next=3',
                method: 'GET',
                headers: {
                    'X-RapidAPI-Key': 'b623da9602mshed8ba93d9fbda04p1ef041jsn0d851f04e40d',
                    'X-RapidAPI-Host': 'api-football-v1.p.rapidapi.com'
                }
            };

            $.ajax(settings).done(function (response) {
                let plantilla = $("#plantilla").val();
                let transformado = procesarTexto(response, plantilla);
                 $("#resultado").html(transformado);
            });


        }
    </script>
</head>

<body>

    <h1>Dev Fest Santiago de Compostela 2023</h1>
    <h2>Creación de contenidos con inteligencia natural</h2>
    <h3>30 de noviembre de 2023 a las 17:30</h3>
    <a href="https://rapidapi.com/api-sports/api/api-football/" target="_blank">Api</a>

    <p>Mi equipo: <input type="text" id="miEquipo" value="9585"></p>
    <button onclick="test ()">Test</button>
    <button onclick="procesar ()">Carga de API</button>
    <hr>

    <p>Plantilla</p>
    <textarea id="plantilla">
          <h1><img src="[[response.0.teams.home.logo]]">  vs <img src="[[response.0.teams.away.logo]]"></h1>
        El partido entre [[response.0.teams.home.name]]  y [[response.0.teams.away.name]] se juega en [[response.0.fixture.venue.name]] ([[response.0.fixture.venue.city]]) 
        el próximo [[formatearFecha->response.0.fixture.date]].
        </textarea>


    <hr>

    <p>Resultado</p>
    <div id="resultado" style="border-width: 1px; border-style:solid; border-color: red">
        Aquí el resultado
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.js"
        integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>

</body>

</html>